(function(n,g){function x(a){return a&&Object.prototype.toString.call(a)==="[object Array]"}function o(a,b){for(var c=0,d=b.length;c<d;c++)if(a===b[c])return c;return-1}function k(a,b){if(x(a))for(var c=0,d=a.length;c<d;c++){if(b.call(a[c],c,a[c])===false)break}else for(c in a)if(a.hasOwnProperty(c))if(b.call(a[c],c,a[c])===false)break}function H(a){return a.replace(/^\s+|\s+$/g,"")}function K(a,b,c){c=c===g?",":c;return(c+b+c).indexOf(c+a+c)>=0}function z(a){return a&&/^\d+$/.test(a)?a+"px":a}function L(a){var b;
return a&&(b=/(\d+)/.exec(a))?parseInt(b[1],10):0}function T(a){function b(c){c=parseInt(c,10).toString(16).toUpperCase();return c.length>1?c:"0"+c}return a.replace(/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/ig,function(c,d,e,f){return"#"+b(d)+b(e)+b(f)})}function O(a,b){b=b===g?",":b;var c={},d=a.split(b),e;k(d,function(f,h){if(e=/^(\d+)\.\.(\d+)$/.exec(h))for(var j=parseInt(e[1],10);j<=parseInt(e[2],10);j++)c[j.toString()]=true;else c[h]=true});return c}function aa(a,b){return Array.prototype.slice.call(a,
b||0)}function ca(a,b){return a===g?b:a}function sa(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else a.attachEvent&&a.attachEvent("on"+b,c)}function ha(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,false);else a.detachEvent&&a.detachEvent("on"+b,c)}function $(a,b){if(b){var c={},d=a.ownerDocument||a.document||a;k(sb,function(f,h){c[h]=b[h]});if(!c.target)c.target=c.srcElement||d;if(c.target.nodeType===3)c.target=c.target.parentNode;if(!c.relatedTarget&&c.fromElement)c.relatedTarget=
c.fromElement===c.target?c.toElement:c.fromElement;if(c.pageX==null&&c.clientX!=null){var e=d.documentElement;d=d.body;c.pageX=c.clientX+(e&&e.scrollLeft||d&&d.scrollLeft||0)-(e&&e.clientLeft||d&&d.clientLeft||0);c.pageY=c.clientY+(e&&e.scrollTop||d&&d.scrollTop||0)-(e&&e.clientTop||d&&d.clientTop||0)}if(!c.which&&(c.charCode||c.charCode===0?c.charCode:c.keyCode))c.which=c.charCode||c.keyCode;if(!c.metaKey&&c.ctrlKey)c.metaKey=c.ctrlKey;if(!c.which&&c.button!==g)c.which=c.button&1?1:c.button&2?3:
c.button&4?2:0;switch(c.which){case 186:c.which=59;break;case 187:case 107:case 43:c.which=61;break;case 189:case 45:c.which=109;break;case 42:c.which=106;break;case 47:c.which=111;break;case 78:c.which=110;break}if(c.which>=96&&c.which<=105)c.which-=48;c.preventDefault=function(){b.preventDefault&&b.preventDefault();b.returnValue=false};c.stopPropagation=function(){b.stopPropagation&&b.stopPropagation();b.cancelBubble=true};c.stop=function(){this.preventDefault();this.stopPropagation()};return c}}
function V(a){var b=o(a,ia);if(b<0){k(ia,function(c,d){if(!d){b=c;ia[b]=a;return false}});if(b<0){b=ia.length;ia.push(a)}}b in E||(E[b]={});return b}function W(a,b,c){if(b.indexOf(",")>=0)k(b.split(","),function(){W(a,this,c)});else{var d=V(a);if(d in E&&E[d][b]!==g&&E[d][b].length>0){k(E[d][b],function(e,f){f===g&&E[d][b].splice(e,1)});ha(a,b,E[d][b][0])}else E[d][b]=[];if(E[d][b].length===0)E[d][b][0]=function(e){k(E[d][b],function(f,h){f>0&&h&&h.call(a,$(a,e))})};o(c,E[d][b])<0&&E[d][b].push(c);
sa(a,b,E[d][b][0])}}function M(a,b,c){if(b&&b.indexOf(",")>=0)k(b.split(","),function(){M(a,this,c)});else{var d=V(a);if(b===g){if(d in E){k(E[d],function(j,m){m.length>0&&ha(a,j,m[0])});delete E[d];delete ia[d]}}else if(E[d][b]!==g&&E[d][b].length>0)if(c===g){ha(a,b,E[d][b][0]);delete E[d][b]}else{for(var e=1,f=E[d][b].length;e<f;e++)E[d][b][e]===c&&delete E[d][b][e];if(E[d][b].length==2&&E[d][b][1]===g){ha(a,b,E[d][b][0]);delete E[d][b]}var h=0;k(E[d],function(){h++});if(h<1){delete E[d];delete ia[d]}}}}
function da(a,b){if(b.indexOf(",")>=0)k(b.split(","),function(){da(a,this)});else{var c=V(a);c in E&&E[c][b]!==g&&E[c][b].length>0&&E[c][b][0]()}}function ba(a){for(var b={},c=/\s*([\w\-]+)\s*:([^;]*)(;|$)/g,d;d=c.exec(a);){var e=H(d[1].toLowerCase());d=H(T(d[2]));b[e]=d}return b}function X(a){for(var b={},c=/\s+(?:([\w-:]+)|(?:([\w-:]+)=([^\s"'<>]+))|(?:([\w-:]+)="([^"]*)")|(?:([\w-:]+)='([^']*)'))(?=(?:\s|\/|>)+)/g,d;d=c.exec(a);)b[d[1]||d[2]||d[4]||d[6]]=(d[2]?d[3]:d[4]?d[5]:d[7])||"";return b}
function R(a){var b="";k(ba(a),function(c,d){b+=c+":"+d+";"});return b}function P(a){a=(a+"").replace(/((?:[\r\n])*)<(\/)?([\w-:]+)(\s*(?:[\w-:]+)(?:=(?:"[^"]*"|'[^']*'|[^\s"'<>]*))?)*\s*(\/)?>((?:[\r\n])*)/g,function(b,c,d,e,f,h,j){b=c||"";d=d||"";e=e.toLowerCase();f=f||"";h=h?" "+h:"";j=j||"";if(h===""&&Pa[e])h=" /";if(j)j="";if(e!=="script"&&e!=="style")b="";if(f!==""){f=f.replace(/\s*([\w-:]+)=([^\s"'<>]+|"[^"]*"|'[^']*')/g,function(m,t,s){m=t.toLowerCase();s=s||"";if(s==="")s='""';else{if(m===
"style"){s=s.substr(1,s.length-2);s=R(s);if(s==="")return"";s='"'+s+'"'}/^['"]/.test(s)||(s='"'+s+'"')}return" "+m+"="+s+" "});f=H(f);if(f=f.replace(/\s+/g," "))f=" "+f;return b+"<"+d+e+f+h+">"+j}else return b+"<"+d+e+h+">"+j});return H(a)}function N(a){if(/\.(rm|rmvb)(\?|$)/i.test(a))return"audio/x-pn-realaudio-plugin";if(/\.(swf|flv)(\?|$)/i.test(a))return"application/x-shockwave-flash";return"video/x-ms-asf-plugin"}function ja(a){var b="<embed ";k(a,function(c,d){b+=c+'="'+d+'" '});b+="/>";return b}
function ka(a,b){for(;b=b.parentNode;)if(b===a)return true;return false}function ta(a,b){b=b.toLowerCase();var c=null;if(Y&&ua<8){var d=a.ownerDocument.createElement("div");d.appendChild(a.cloneNode(false));d=X(d.innerHTML.toLowerCase());if(b in d)c=d[b]}else c=a.getAttribute(b,2);if(b==="style"&&c!==null)c=R(c);return c}function la(a,b){function c(B){if(typeof B!="string")return B;return B.replace(/([^\w\-])/g,"\\$1")}function d(B,D){return B==="*"||B.toLowerCase()===c(D.toLowerCase())}function e(B,
D,C){var w=[];(B=(C.ownerDocument||C).getElementById(B.replace(/\\/g,"")))&&d(D,B.nodeName)&&ka(C,B)&&w.push(B);return w}function f(B,D,C){var w=C.ownerDocument||C,F=[],J,Q,U;if(C.getElementsByClassName){w=C.getElementsByClassName(B.replace(/\\/g,""));J=0;for(Q=w.length;J<Q;J++){U=w[J];d(D,U.nodeName)&&F.push(U)}}else if(w.querySelectorAll){w=w.querySelectorAll((C.nodeName!=="#document"?C.nodeName+" ":"")+D+"."+B);J=0;for(Q=w.length;J<Q;J++){U=w[J];ka(C,U)&&F.push(U)}}else{w=C.getElementsByTagName(D);
J=0;for(Q=w.length;J<Q;J++){U=w[J];if(U.nodeType==1)(D=U.className)&&(" "+D+" ").indexOf(" "+B+" ")>-1&&F.push(U)}}return F}function h(B,D,C,w){var F=[];C=w.getElementsByTagName(C);for(var J=0,Q=C.length;J<Q;J++){w=C[J];if(w.nodeType==1)if(D===null)ta(w,B)!==null&&F.push(w);else D===c(ta(w,B))&&F.push(w)}return F}function j(B,D){var C=[],w,F=(w=/^((?:\\.|[^.#\s\[<>])+)/.exec(B))?w[1]:"*";if(w=/#((?:[\w\-]|\\.)+)$/.exec(B))C=e(w[1],F,D);else if(w=/\.((?:[\w\-]|\\.)+)$/.exec(B))C=f(w[1],F,D);else if(w=
/\[((?:[\w\-]|\\.)+)\]/.exec(B))C=h(w[1].toLowerCase(),null,F,D);else if(w=/\[((?:[\w\-]|\\.)+)\s*=\s*['"]?((?:\\.|[^'"]+)+)['"]?\]/.exec(B)){C=w[1].toLowerCase();w=w[2];if(C==="id")F=e(w,F,D);else{if(C==="class")F=f(w,F,D);else{if(C==="name"){C=[];w=(D.ownerDocument||D).getElementsByName(w.replace(/\\/g,""));for(var J,Q=0,U=w.length;Q<U;Q++){J=w[Q];d(F,J.nodeName)&&ka(D,J)&&J.getAttributeNode("name")&&C.push(J)}F=C}else F=h(C,w,F,D);F=F}F=F}C=F}else{F=D.getElementsByTagName(F);J=0;for(Q=F.length;J<
Q;J++){w=F[J];w.nodeType==1&&C.push(w)}}return C}b=b||document;for(var m=[],t,s=/((?:\\.|[^\s>])+|[\s>])/g;t=s.exec(a);)t[1]!==" "&&m.push(t[1]);t=[];if(m.length==1)return j(m[0],b);s=false;var q,p,r,v,A,y,u,G,I,S;y=0;for(lenth=m.length;y<lenth;y++){q=m[y];if(q===">")s=true;else{if(y>0){p=[];u=0;for(I=t.length;u<I;u++){v=t[u];r=j(q,v);G=0;for(S=r.length;G<S;G++){A=r[G];if(s)v===A.parentNode&&p.push(A);else p.push(A)}}t=p}else t=j(q,b);if(t.length===0)return[]}}return t}function Z(a){return a.get?
a.get():a}function Ea(a){var b=a.split("-");a="";k(b,function(c,d){a+=c>0?d.charAt(0).toUpperCase()+d.substr(1):d});return a}function Fa(a,b,c){if(Y&&ua<8&&b.toLowerCase()=="class")b="className";a.setAttribute(b,""+c)}function Ga(a){if(!a)return document;return a.ownerDocument||a.document||a}function Aa(a){if(!a)return n;a=Ga(a);return a.parentWindow||a.defaultView}function Ha(a){if(!a||!a.nodeName)return"";return a.nodeName.toLowerCase()}function tb(a,b){var c=Aa(a),d=Ea(b),e="";if(c.getComputedStyle){c=
c.getComputedStyle(a,null);e=c[d]||c.getPropertyValue(b)||a.style[d]}else if(a.currentStyle)e=a.currentStyle[d]||a.style[d];return e}function ea(a){a=a||document;return a.compatMode!="CSS1Compat"?a.body:a.documentElement}function ub(a){a=ea(a);return Math.max(a.scrollHeight,a.clientHeight)}function vb(a){a=ea(a);return Math.max(a.scrollWidth,a.clientWidth)}function Ia(){var a,b;if(Y||Qa){a=ea().scrollLeft;b=ea().scrollTop}else{a=n.scrollX;b=n.scrollY}return{x:a,y:b}}function fa(a){var b=this;k(a,
function(c){b[c]=this});b.length=a.length;b.doc=Ga(b[0]);b.name=Ha(b[0]);b.type=b.length>0?b[0].nodeType:null;b.win=Aa(b[0]);b._data={}}function Ra(){this.collapsed=this.startContainer===this.endContainer&&this.startOffset===this.endOffset}function Ja(a,b){function c(A,y,u){var G=A.nodeValue.length,I;if(a){I=A.cloneNode(true).splitText(y);I.splitText(u-y)}if(b){var S=A;if(y>0)S=A.splitText(y);u<G&&S.splitText(u-y);t.push(S)}return I}function d(A,y){var u;if(A.nodeType==3){u=c(A,h,m);a&&y.appendChild(u);
return false}u=A.firstChild;for(var G,I=false,S=false,B=false,D=false;u;){G=new oa(e);G.selectNode(u);I||(I=G.compareBoundaryPoints(va,s)>0);if(I&&!S)S=G.compareBoundaryPoints(Ba,s)>=0;if(S&&!B)B=G.compareBoundaryPoints(wa,s)>0;if(B&&!D)D=G.compareBoundaryPoints(xa,s)>=0;if(D)return false;G=u.nextSibling;if(I)if(u.nodeType==1)if(S&&!B){a&&y.appendChild(u.cloneNode(true));b&&t.push(u)}else{var C;if(a){C=u.cloneNode(false);y.appendChild(C)}if(d(u,C)===false)return false}else if(u.nodeType==3){u=u==
f&&u==j?c(u,h,m):u==f?c(u,h,u.nodeValue.length):u==j?c(u,0,m):c(u,0,u.nodeValue.length);a&&y.appendChild(u)}u=G}}var e=this.doc,f=this.startContainer,h=this.startOffset,j=this.endContainer,m=this.endOffset,t=[],s=this;if(b){s=this.cloneRange();f.nodeType==3&&h===0&&this.setStart(f.parentNode,0);this.collapse(true)}var q=e.createDocumentFragment();d(s.commonAncestor(),q);for(var p=0,r=t.length;p<r;p++){var v=t[p];v.parentNode&&v.parentNode.removeChild(v)}return a?q:this}function pa(a,b){var c;a:{for(c=
b;c;){if(i(c).name==="marquee"){c=true;break a}c=c.parentNode}c=false}c||a.moveToElementText(b)}function Sa(a,b){var c=a.parentElement().ownerDocument,d=a.duplicate();d.collapse(b);var e=d.parentElement(),f=e.childNodes;if(f.length===0)return{node:e.parentNode,offset:i(e).index()};c=c;var h=0,j=false,m=a.duplicate();pa(m,e);for(var t=0,s=f.length;t<s;t++){var q=f[t],p=m.compareEndPoints("StartToStart",d);if(p>0)j=true;if(p===0)return{node:q.parentNode,offset:t};if(q.nodeType==1){p=a.duplicate();pa(p,
q);m.setEndPoint("StartToEnd",p);if(j)h+=p.text.replace(/\r\n|\n|\r/g,"").length;else h=0}else if(q.nodeType==3){m.moveStart("character",q.nodeValue.length);h+=q.nodeValue.length}j||(c=q)}if(!j&&c.nodeType==1)return{node:e,offset:i(e.lastChild).index()+1};m=a.duplicate();pa(m,e);m.setEndPoint("StartToEnd",d);h-=m.text.replace(/\r\n|\n|\r/g,"").length;return{node:c,offset:h}}function Ta(a){var b=a.ownerDocument,c=0;for(a=a.previousSibling;a;){if(a.nodeType==1)if(i(a).isSingle())c+=1;else{var d=b.body.createTextRange();
pa(d,a);c+=d.text.length}else if(a.nodeType==3)c+=a.nodeValue.length;a=a.previousSibling}return c}function Ua(a,b){var c=a.ownerDocument||a,d=c.body.createTextRange();if(c==a){d.collapse(true);return d}if(a.nodeType==1){var e=a.childNodes,f,h=false,j;if(b===0){f=e[0];e=true}else{f=e[b-1];e=false}if(!f){j=c.createTextNode(" ");a.appendChild(j);f=j;h=true}if(f.nodeName.toLowerCase()==="head"){if(b===1)e=true;if(b===2)e=false;d.collapse(e);return d}if(f.nodeType==1){pa(d,f);d.collapse(e)}else{pa(d,a);
h&&a.removeChild(j);c=Ta(f);c=e?c:c+f.nodeValue.length;d.moveStart("character",c)}}else if(a.nodeType==3){pa(d,a.parentNode);d.moveStart("character",b+Ta(a))}return d}function oa(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this.collapsed=true;this.doc=a}function Ca(a){if(!a.nodeName){if(a.get)a=a;else a:{var b;if(Y){if(a.item){b=Ga(a.item(0));b=new oa(b);b.selectNode(a.item(0));a=b;break a}b=a.parentElement().ownerDocument;var c=Sa(a,true);a=Sa(a,false);b=new oa(b);
b.setStart(c.node,c.offset);b.setEnd(a.node,a.offset)}else{c=a.startContainer;b=c.ownerDocument||c;b=new oa(b);b.setStart(c,a.startOffset);b.setEnd(a.endContainer,a.endOffset)}a=b}return a}return new oa(a)}function ya(a,b,c){try{a.execCommand(b,false,c)}catch(d){}}function Va(a,b){var c="";try{c=a.queryCommandValue(b)}catch(d){}if(typeof c!=="string")c="";return c}function Wa(a){var b=Aa(a);return b.getSelection?b.getSelection():a.selection}function Xa(a){var b=Wa(a),c;try{c=b.rangeCount>0?b.getRangeAt(0):
b.createRange()}catch(d){}if(Y&&(!c||!c.item&&c.parentElement().ownerDocument!==a))return null;return c}function Ya(a){var b={},c,d;k(a,function(e,f){c=e.split(",");for(var h=0,j=c.length;h<j;h++){d=c[h];b[d]=f}});return b}function Ka(a,b){return Za(a,b,"*")||Za(a,b)}function Za(a,b,c){c=c||a.name;if(a.type!==1)return false;b=Ya(b);var d,e;if(b[c]){c=b[c].split(",");for(var f=0,h=c.length;f<h;f++){b=c[f];if(b==="*")return true;d=/^(\.?)([^=]+)(?:=([^=]+))?$/.exec(b);e=d[1]?"css":"attr";b=d[2];d=d[3]||
"";if(d===""&&a[e](b)!=="")return true;if(d!==""&&a[e](b)===d)return true}}return false}function $a(a){for(var b=a.first();b;){var c=b.next();a.before(b);b=c}a.remove()}function ab(a,b,c){c=c||a.name;if(a.type===1){b=Ya(b);if(b[c]){c=b[c].split(",");allFlag=false;for(var d=0,e=c.length;d<e;d++){b=c[d];if(b==="*"){allFlag=true;break}var f=/^(\.?)([^=]+)(?:=([^=]+))?$/.exec(b);b=f[2];f[1]?a.css(b,""):a.removeAttr(b)}allFlag&&$a(a)}}}function qa(a){for(a=a;a.first();)a=a.first();return a}function bb(a,
b){a=a.clone(true);for(var c=qa(a),d=a,e=false;b;){for(;d;){if(d.name===b.name){wb(d,b.attr(),b.css());e=true}d=d.first()}e||c.append(b.clone(false));e=false;b=b.first()}return a}function wb(a,b,c){k(b,function(d,e){d!=="style"&&a.attr(d,e)});k(c,function(d,e){a.css(d,e)})}function Da(a){var b=a.doc;this.doc=b;this.win=Aa(b);this.sel=Wa(b);this.range=a;this._preremove=this._preformat=null}function cb(a){if(a.nodeName){var b=a.ownerDocument||a;a=Ca(b).selectNodeContents(b.body).collapse(false);var c=
new Da(a);c.onchange(function(){var d=Xa(b);if(d)c.range=Ca(d)});c.oninput(function(){c._applyPreformat()});c.oncursormove(function(){c._preformat=null;c._preremove=null});La&&i(b).click(function(d){if(i(d.target).name==="img"){var e=Xa(b);if(e)c.range=Ca(e);c.range.selectNode(d.target);c.select()}});return c}return new Da(a)}function db(a){var b=a.moveEl,c=a.moveFn,d=a.clickEl||b,e=[document],f=[{x:0,y:0}],h=[];(a.iframeFix===g?true:a.iframeFix)&&i("iframe").each(function(){e.push(Ma(this));f.push(i(this).pos())});
d.mousedown(function(j){var m=d.get(),t=L(b.css("left")),s=L(b.css("top")),q=b.width(),p=b.height(),r=j.pageX,v=j.pageY,A=true;k(e,function(y,u){function G(B){if(A){var D=ma(f[y].x+B.pageX-r),C=ma(f[y].y+B.pageY-v);c.call(d,t,s,q,p,D,C)}B.stop()}function I(B){B.stop()}function S(B){A=false;m.releaseCapture&&m.releaseCapture();k(h,function(){i(this.doc).unbind("mousemove",this.move).unbind("mouseup",this.up).unbind("selectstart",this.select)});B.stop()}i(u).mousemove(G).mouseup(S).bind("selectstart",
I);h.push({doc:u,move:G,up:S,select:I})});m.setCapture&&m.setCapture();j.stop()})}function ra(a){function b(v,A){if(f&&(a.x===g||a.y===g)){var y=L(v)||0,u=L(A)||0;if(a.alignEl){var G=a.alignEl,I=i(G).pos();y=ma(G.clientWidth/2-y/2);u=ma(G.clientHeight/2-u/2);d=y<0?I.x:I.x+y;e=u<0?I.y:I.y+u}else{I=ea(q);G=Ia();d=ma(G.x+(I.clientWidth-y)/2);e=ma(G.y+(I.clientHeight-u)/2)}d=d<0?0:z(d);e=e<0?0:z(e);r.css({left:d,top:e})}}var c=a.name||"",d=z(a.x),e=z(a.y),f=a.z,h=z(a.width),j=z(a.height),m=a.cls,t=a.css,
s=a.html,q=a.doc||document,p=a.parent||q.body,r=i('<div style="display:block;"></div>');h&&r.css("width",h);j&&r.css("height",j);f&&r.css({position:"absolute",left:d,top:e,"z-index":f});b(h,j);m&&r.addClass(m);t&&r.css(t);s&&r.html(s);i(p).append(r);return{name:c,doc:q,div:function(){return r},remove:function(){r.remove();return this},show:function(){r.show();return this},hide:function(){r.hide();return this},draggable:function(v){v=v||{};v.moveEl=r;v.moveFn=function(A,y,u,G,I,S){if((A+=I)<0)A=0;
if((y+=S)<0)y=0;r.css("left",z(A)).css("top",z(y))};db(v);return this},resetPos:b}}function Ma(a){a=Z(a);return a.contentDocument||a.contentWindow.document}function xb(a,b,c,d){var e=['<html><head><meta charset="utf-8" /><title>KindEditor</title>',"<style>","html {margin:0;padding:0;}","body {margin:0;padding:0;}",'body, td {font:12px/1.5 "sans serif",tahoma,verdana,helvetica;}',"p {margin:5px 0;}","table {border-collapse:collapse;}","table.ke-zeroborder td {border:1px dotted #AAAAAA;}",".ke-flash {",
"\tborder:1px solid #AAAAAA;","\tbackground-image:url("+a+"common/flash.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}",".ke-rm {","\tborder:1px solid #AAAAAA;","\tbackground-image:url("+a+"common/rm.gif);","\tbackground-position:center center;","\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}",".ke-media {","\tborder:1px solid #AAAAAA;","\tbackground-image:url("+a+"common/media.gif);","\tbackground-position:center center;",
"\tbackground-repeat:no-repeat;","\twidth:100px;","\theight:100px;","}","</style>"];if(x(c))k(c,function(f,h){h!==""&&e.push('<link href="'+h+'" rel="stylesheet" />')});else c!==""&&e.push('<link href="'+c+'" rel="stylesheet" />');d&&e.push("<style>"+d+"</style>");e.push("</head><body "+(b?'class="'+b+'"':"")+"></body></html>");return e.join("")}function eb(a){var b=ra(a),c=b.remove,d=z(a.width),e=z(a.height),f=i(a.srcElement),h=a.designMode===g?true:a.designMode,j=a.themesPath,m=a.bodyClass,t=a.cssPath;
a=a.cssData;var s=b.div().addClass("ke-edit"),q=i('<iframe class="ke-edit-iframe" frameborder="0"></iframe>'),p=i('<textarea class="ke-edit-textarea" kindeditor="true"></textarea>');q.css("width","100%");p.css("width","100%");b.width=function(v){s.css("width",z(v));return b};b.height=function(v){v=z(v);s.css("height",v);q.css("height",v);if(Y&&ua<8||document.compatMode!="CSS1Compat")v=z(L(v)-2);p.css("height",v);return b};d&&b.width(d);e&&b.height(e);h?p.hide():q.hide();s.append(q);s.append(p);f.hide();
var r=Ma(q);if(!Y)r.designMode="on";r.open();r.write(xb(j,m,t,a));r.close();if(Y)r.body.contentEditable="true";b.iframe=q;b.textarea=p;b.doc=r;b.remove=function(){i(r).unbind();i(r.body).unbind();i(document).unbind();var v=b.html();f.hasVal()?f.val(v):f.html(v);f.removeAttr("kindeditor");f.show();r.write("");r.clear();q.remove();p.remove();c.call(b);return b};b.html=function(v){if(h){var A=r.body;if(v===g)return i(A).html();i(A).html(v);return b}if(v===g)return p.val();p.val(v);return b};b.design=
function(v){if(v===g?!h:v){if(!h){v=b.html();h=true;b.html(v);p.hide();q.show()}}else if(h){v=b.html();h=false;b.html(v);q.hide();p.show()}b.focus();return b};b.focus=function(){h?q.get().contentWindow.focus():p.get().focus();return b};b.html(f.hasVal()?f.val(void 0):f.html(void 0));b.cmd=cb(r);return b}function fb(a,b){a.mouseover(function(){i(this).addClass("ke-toolbar-icon-outline-on")}).mouseout(function(){i(this).removeClass("ke-toolbar-icon-outline-on")}).click(function(c){b.click.call(this,
c);c.stop()})}function gb(a){var b=ra(a),c=b.remove,d=a.disableMode===g?false:a.disableMode,e=a.noDisableItems===g?[]:a.noDisableItems,f=b.div(),h={};f.addClass("ke-toolbar").bind("contextmenu,mousedown,mousemove",function(j){j.preventDefault()});b.get=function(j){return h[j]};b.addItem=function(j){var m;if(j.name=="|")m=i('<span class="ke-inline-block ke-toolbar-separator"></span>');else if(j.name=="/")m=i("<br />");else{m=i('<a class="ke-inline-block ke-toolbar-icon-outline" href="#" title="'+(j.title||
"")+'"><span class="ke-inline-block ke-toolbar-icon ke-toolbar-icon-url ke-icon-'+j.name+'"></span></a>');fb(m,j)}m.data("item",j);h[j.name]=m;f.append(m)};b.remove=function(){k(h,function(j,m){m.remove()});c.call(b)};b.disable=function(j){var m;if(j===g?!d:j){k(h,function(t,s){m=s.data("item");if(m.name!=="/"&&o(m.name,e)<0){s.addClass("ke-toolbar-icon-outline-disabled");s.opacity(0.5);m.name!=="|"&&s.unbind()}});d=true}else{k(h,function(t,s){m=s.data("item");if(m.name!=="/"&&o(m.name,e)<0){s.removeClass("ke-toolbar-icon-outline-disabled");
s.opacity(1);m.name!=="|"&&fb(s,m)}});d=false}};return b}function hb(a){a.z=a.z||811213;var b=ra(a),c=b.div(),d=b.remove,e=a.centerLineMode===g?true:a.centerLineMode;c.addClass("ke-menu");b.addItem=function(f){if(f.title==="-")c.append(i('<div class="ke-menu-separator"></div>'));else{var h=i('<div class="ke-menu-item"></div>'),j=i('<div class="ke-inline-block ke-menu-item-left"></div>'),m=i('<div class="ke-inline-block ke-menu-item-right"></div>'),t=z(f.height),s=f.iconClass;c.append(h);if(t){h.css("height",
t);m.css("line-height",t)}var q;if(e){q=i('<div class="ke-inline-block ke-menu-item-center"></div>');t&&q.css("height",t)}h.mouseover(function(){i(this).addClass("ke-menu-item-on");q&&q.addClass("ke-menu-item-center-on")});h.mouseout(function(){i(this).removeClass("ke-menu-item-on");q&&q.removeClass("ke-menu-item-center-on")});h.click(function(p){f.click.call(i(this));p.stop()});h.append(j);q&&h.append(q);h.append(m);if(f.checked)s="ke-icon-checked";j.html('<span class="ke-inline-block ke-toolbar-icon ke-toolbar-icon-url '+
s+'"></span>');m.html(f.title)}};b.remove=function(){i(".ke-menu-item",c.get()).remove();d.call(b)};return b}function ib(a){function b(p,r,v){p=i(p).addClass(v);e===r.toLowerCase()&&p.addClass("ke-colorpicker-cell-selected");p.attr("title",r||a.noColor);p.mouseover(function(){i(this).addClass("ke-colorpicker-cell-on")});p.mouseout(function(){i(this).removeClass("ke-colorpicker-cell-on")});p.click(function(A){a.click.call(i(this),r);A.stop()});r?p.append(i('<div class="ke-colorpicker-cell-color"></div>').css("background-color",
r)):p.html(a.noColor);h.push(p)}a.z=a.z||811213;var c=ra(a),d=a.colors||[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]],e=(a.selectedColor||"").toLowerCase(),f=c.remove,h=[];c.div().addClass("ke-colorpicker");var j=c.doc.createElement("table");c.div().append(j);j.className="ke-colorpicker-table";j.cellPadding=
0;j.cellSpacing=0;j.border=0;var m=j.insertRow(0),t=m.insertCell(0);t.colSpan=d[0].length;b(t,"","ke-colorpicker-cell-top");for(var s=0;s<d.length;s++){m=j.insertRow(s+1);for(var q=0;q<d[s].length;q++){t=m.insertCell(q);b(t,d[s][q],"ke-colorpicker-cell")}}c.remove=function(){k(h,function(){this.unbind()});f.call(c)};return c}function jb(a){a.z=a.z||811213;var b=ra(a),c=b.remove,d=z(a.width),e=z(a.height),f=b.doc,h=b.div(),j=a.title,m=i(a.body,f),t=a.previewBtn,s=a.yesBtn,q=a.noBtn,p=a.closeBtn;a=
a.shadowMode===g?true:a.shadowMode;var r=f.documentElement,v=Math.max(r.scrollWidth,r.clientWidth);r=Math.max(r.scrollHeight,r.clientHeight);h.addClass("ke-dialog").bind("click,mousedown",function(Q){Q.stopPropagation()});var A;if(a){f=f.createElement("table");f.className="ke-dialog-table";f.cellPadding=0;f.cellSpacing=0;f.border=0;h.append(f);var y=["t","m","b"],u=["l","c","r"],G,I,S,B;G=0;for(len=3;G<len;G++){S=f.insertRow(G);I=0;for(l=3;I<l;I++){B=S.insertCell(I);B.className="ke-"+y[G]+u[I];if(G==
1&&I==1)A=i(B);else B.innerHTML='<span class="ke-dialog-empty"></span>'}}A.css({width:d,height:e,"vertical-align":"top"})}else{h.addClass("ke-dialog-no-shadow");A=h}var D=i('<div class="ke-dialog-header"></div>');A.append(D);D.html(j);var C=i('<span class="ke-dialog-icon-close ke-dialog-icon-close-'+(a?"":"no-")+'shadow" title="'+p.name+'"></span>').click(p.click);D.append(C);b.draggable({clickEl:D});var w=i('<div class="ke-dialog-body"></div>');A.append(w);w.append(m);var F=i('<div class="ke-dialog-footer"></div>');
if(t||s||q)A.append(F);k([{btn:t,name:"preview"},{btn:s,name:"yes"},{btn:q,name:"no"}],function(){var Q=this.btn;if(Q){var U=i('<input type="button" class="ke-dialog-'+this.name+'" value="'+Q.name+'" />');F.append(U);U.click(Q.click)}});e&&w.height(L(e)-D.height()-F.height());var J=ra({x:0,y:0,z:811212,cls:"ke-dialog-mask",width:v,height:r});b.resetPos(h.width(),h.height());b.remove=function(){J.remove();C.remove();i("input",h.get()).remove();F.remove();w.remove();D.remove();c.call(b)};b.show=function(){J.show();
h.show()};b.hide=function(){J.hide();h.hide()};return b}function kb(a){var b,c="core";if(b=/^(\w+)\.(\w+)$/.exec(a)){c=b[1];a=b[2]}return{ns:c,key:a}}function lb(a,b){b=b===g?za.langType:b;if(typeof a==="string"){if(!na[b])return"no language";var c=a.length-1;if(a.substr(c)===".")return na[b][a.substr(0,c)];c=kb(a);return na[b][c.ns][c.key]}k(a,function(d,e){var f=kb(d);na[b]||(na[b]={});na[b][f.ns]||(na[b][f.ns]={});na[b][f.ns][f.key]=e})}function mb(a){var b=this;k(a,function(d){b[d]=a[d];if(d===
"scriptPath"){b.themesPath=a[d]+"themes/";b.pluginsPath=a[d]+"plugins/"}});k(za,function(d,e){if(b[d]===g)b[d]=e});var c=i(b.srcElement);if(!b.width)b.width=c.width()||b.minWidth;if(!b.height)b.height=c.height()||b.minHeight;b.width=z(b.width);b.height=z(b.height);b.srcElement=c;b._handlers={};k(nb,function(){this.call(b,KindEditor)})}var ga=navigator.userAgent.toLowerCase(),Y=ga.indexOf("msie")>-1&&ga.indexOf("opera")==-1,Na=ga.indexOf("gecko")>-1&&ga.indexOf("khtml")==-1,La=ga.indexOf("applewebkit")>
-1,Qa=ga.indexOf("opera")>-1,ua=(ga=/(?:msie|firefox|webkit|opera)[\/:\s](\d+)/.exec(ga))?ga[1]:"0",ma=Math.round,i={kindeditor:"4.0 (2010-07-28)",IE:Y,GECKO:Na,WEBKIT:La,OPERA:Qa,VERSION:ua,each:k,isArray:x,isFunction:function(a){return a&&Object.prototype.toString.call(a)==="[object Function]"},inArray:o,inString:K,trim:H,addUnit:z,removeUnit:L,escape:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},unescape:function(a){return a.replace(/&lt;/g,
"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},toHex:T,toMap:O,toArray:aa,undef:ca,json:function(a){var b;if(b=/\{[\s\S]*\}|\[[\s\S]*\]/.exec(a))a=b[0];b=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;b.lastIndex=0;if(b.test(a))a=a.replace(b,function(c){return"\\u"+("0000"+c.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return eval("("+a+")");throw"JSON parse error";}},ob=O("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),yb=O("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),Pa=O("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed");
O("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr");O("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected");var pb=O("input,button,textarea,select"),za={designMode:true,fullscreenMode:false,filterMode:false,shadowMode:true,scriptPath:function(){for(var a=document.getElementsByTagName("script"),b,c=0,d=a.length;c<d;c++){b=a[c].src||"";if(/kindeditor[\w\-\.]*\.js/.test(b))return b.substring(0,b.lastIndexOf("/")+1)}return""}(),langType:"zh_CN",urlType:"",
newlineType:"p",resizeType:2,dialogAlignType:"page",bodyClass:"ke-content",cssPath:"",cssData:"",minWidth:550,minHeight:100,minChangeSize:5,shortcutKeys:{undo:"Z",redo:"Y",bold:"B",italic:"I",underline:"U",selectall:"A",print:"P"},items:["source","|","fullscreen","undo","redo","print","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","|","selectall","/",
"formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","removeformat","|","image","flash","media","table","hr","emoticons","link","unlink","|","about"],colors:[["#E53333","#E56600","#FF9900","#64451D","#DFC5A4","#FFE500"],["#009900","#006600","#99BB00","#B8D100","#60D978","#00D5FF"],["#337FE5","#003399","#4C33E5","#9933E5","#CC33E5","#EE33EE"],["#FFFFFF","#CCCCCC","#999999","#666666","#333333","#000000"]],htmlTags:{font:["color","size","face",
".background-color"],span:[".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align"],div:["align",".border",".margin",".padding",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".background",".font-style",".text-decoration",".vertical-align",".margin-left"],table:["border","cellspacing","cellpadding","width","height","align","bordercolor",".padding",".margin",".border","bgcolor",".text-align",
".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".background",".width",".height"],"td,th":["align","valign","width","height","colspan","rowspan","bgcolor",".text-align",".color",".background-color",".font-size",".font-family",".font-weight",".font-style",".text-decoration",".vertical-align",".background"],a:["href","target","name"],embed:["src","width","height","type","loop","autostart","quality",".width",".height","align","allowscriptaccess",
"/"],img:["src","width","height","border","alt","title",".width",".height","/"],hr:["/"],br:["/"],"p,ol,ul,li,blockquote,h1,h2,h3,h4,h5,h6":["align",".text-align",".color",".background-color",".font-size",".font-family",".background",".font-weight",".font-style",".text-decoration",".vertical-align",".text-indent",".margin-left"],"tbody,tr,strong,b,sub,sup,em,i,u,strike":[]}};za.themesPath=za.scriptPath+"themes/";za.pluginsPath=za.scriptPath+"plugins/";var sb="altKey,attrChange,attrName,bubbles,button,cancelable,charCode,clientX,clientY,ctrlKey,currentTarget,data,detail,eventPhase,fromElement,handler,keyCode,layerX,layerY,metaKey,newValue,offsetX,offsetY,originalTarget,pageX,pageY,prevValue,relatedNode,relatedTarget,screenX,screenY,shiftKey,srcElement,target,toElement,view,wheelDelta,which".split(","),
ia=[],E={};Y&&n.attachEvent("onunload",function(){k(ia,function(a,b){b&&M(b)})});i.ctrl=function(a,b,c){b=/^\d{2,}$/.test(b)?b:b.toUpperCase().charCodeAt(0);W(a,"keydown",function(d){if(d.ctrlKey&&d.which==b&&!d.shiftKey&&!d.altKey){c.call(a);d.stop()}})};i.ready=function(a,b){function c(){if(!f){f=true;a(KindEditor)}M(b,"DOMContentLoaded");M(b,"readystatechange");M(e,"load")}function d(){if(!f){try{b.documentElement.doScroll("left")}catch(h){e.setTimeout(d,0);return}c()}}b=b||document;var e=b.parentWindow||
b.defaultView,f=false;if(b.addEventListener)W(b,"DOMContentLoaded",c);else if(b.attachEvent){W(b,"readystatechange",function(){b.readyState==="complete"&&c()});b.documentElement.doScroll&&e.frameElement===g&&d()}W(e,"load",c)};i.formatHtml=P;i.mediaType=N;i.mediaAttrs=function(a){return X(unescape(a))};i.mediaEmbed=ja;i.mediaImg=function(a,b){var c=b.width,d=b.height,e=b.type||N(b.src),f=ja(b),h="";if(c>0)h+="width:"+c+"px;";if(d>0)h+="height:"+d+"px;";c='<img class="'+(/realaudio/i.test(e)?"ke-rm":
/flash/i.test(e)?"ke-flash":"ke-media")+'" src="'+a+'" ';if(h!=="")c+='style="'+h+'" ';c+='kesrctag="'+escape(f)+'" alt="" />';return c};i.query=function(a,b){var c=la(a,b);return c.length>0?c[0]:null};i.queryAll=la;fa.prototype={each:function(a){for(var b=0;b<this.length;b++)if(a.call(this[b],b,this[b])===false)return this;return this},bind:function(a,b){this.each(function(){W(this,a,b)});return this},unbind:function(a,b){this.each(function(){M(this,a,b)});return this},fire:function(a){if(this.length<
1)return this;da(this[0],a);return this},hasAttr:function(a){if(this.length<1)return null;return ta(this[0],a)},attr:function(a,b){var c=this;if(a===g)return X(c.outer());if(typeof a==="object"){k(a,function(d,e){c.attr(d,e)});return c}if(b===g){b=c.length<1?null:ta(c[0],a);return b===null?"":b}c.each(function(){Fa(this,a,b)});return c},removeAttr:function(a){this.each(function(){var b=a;if(Y&&ua<8&&b.toLowerCase()=="class")b="className";Fa(this,b,"");this.removeAttribute(b)});return this},get:function(a){if(this.length<
1)return null;return this[a||0]},hasClass:function(a){if(this.length<1)return false;return K(a,this[0].className," ")},addClass:function(a){this.each(function(){if(!K(a,this.className," "))this.className=H(this.className+" "+a)});return this},removeClass:function(a){this.each(function(){if(K(a,this.className," "))this.className=H(this.className.replace(new RegExp("\\s*"+a+"\\s*"),""))});return this},html:function(a){if(a===g){if(this.length<1)return"";return P(this[0].innerHTML)}this.each(function(){var b=
P(a);if(this.nodeType==1)this.innerHTML=""+b});return this},hasVal:function(){if(this.length<1)return false;return!!pb[Ha(this[0])]},val:function(a){if(a===g){if(this.length<1)return"";return this.hasVal()?this[0].value:this.attr("value")}else{this.each(function(){if(pb[Ha(this)])this.value=a;else Fa(this,"value",a)});return this}},css:function(a,b){var c=this;if(a===g)return ba(c.attr("style"));if(typeof a==="object"){k(a,function(d,e){c.css(d,e)});return c}if(b===g){if(c.length<1)return"";return c[0].style[a]||
tb(c[0],a)||""}c.each(function(){this.style[Ea(a)]=b});return c},width:function(a){if(a===g){if(this.length<1)return 0;return this[0].offsetWidth}return this.css("width",z(a))},height:function(a){if(a===g){if(this.length<1)return 0;return this[0].offsetHeight}return this.css("height",z(a))},opacity:function(a){this.each(function(){if(this.style.opacity===g)this.style.filter=a==1?"":"alpha(opacity="+a*100+")";else this.style.opacity=a==1?"":a});return this},data:function(a,b){if(b===g)return this._data[a];
this._data[a]=b;return this},pos:function(){var a=this[0],b=0,c=0;if(a)if(a.getBoundingClientRect){a=a.getBoundingClientRect();c=Ia();b=a.left+c.x;c=a.top+c.y}else for(;a;){b+=a.offsetLeft;c+=a.offsetTop;a=a.offsetParent}return{x:ma(b),y:ma(c)}},clone:function(a){if(this.length<1)return new fa([]);return new fa([this[0].cloneNode(a)])},append:function(a){if(this.length<1)return this;this[0].appendChild(Z(a));return this},before:function(a){if(this.length<1)return this;this[0].parentNode.insertBefore(Z(a),
this[0]);return this},after:function(a){if(this.length<1)return this;this[0].nextSibling?this[0].parentNode.insertBefore(Z(a),this[0].nextSibling):this[0].appendChild(Z(a));return this},replaceWith:function(a){a=Z(a);if(this.length<1)return this;M(this[0]);this[0].parentNode.replaceChild(a,this[0]);this[0]=a;return this},remove:function(){var a=this;a.each(function(b,c){M(c);if(c.hasChildNodes())c.innerHTML="";c.parentNode&&c.parentNode.removeChild(c);delete a[b]});a.length=0;return a},show:function(a){return this.css("display",
a===g?"block":a)},hide:function(){return this.css("display","none")},outer:function(){if(this.length<1)return"";var a=this.doc.createElement("div");a.appendChild(this[0].cloneNode(true));return P(a.innerHTML)},isSingle:function(){return!!Pa[this.name]},isInline:function(){return!!ob[this.name]},isBlock:function(){return!!yb[this.name]},contains:function(a){if(this.length<1)return false;return ka(this[0],Z(a))},parent:function(){if(this.length<1)return null;var a=this[0].parentNode;return a?new fa([a]):
null},children:function(){if(this.length<1)return[];for(var a=[],b=this[0].firstChild;b;){if(b.nodeType!=3||H(b.nodeValue)!=="")a.push(new fa([b]));b=b.nextSibling}return a},first:function(){var a=this.children();return a.length>0?a[0]:null},last:function(){var a=this.children();return a.length>0?a[a.length-1]:null},index:function(){if(this.length<1)return-1;for(var a=-1,b=this[0];b;){a++;b=b.previousSibling}return a},prev:function(){if(this.length<1)return null;var a=this[0].previousSibling;return a?
new fa([a]):null},next:function(){if(this.length<1)return null;var a=this[0].nextSibling;return a?new fa([a]):null},scan:function(a,b){function c(d){for(d=b?d.firstChild:d.lastChild;d;){var e=b?d.nextSibling:d.previousSibling;if(a(d)===false)return false;if(c(d)===false)return false;d=e}}if(!(this.length<1)){b=b===g?true:b;c(this[0]);return this}}};k("blur,focus,focusin,focusout,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error".split(","),
function(a,b){fa.prototype[b]=function(c){return c?this.bind(b,c):this.fire(b)}});Na=i;i=function(a,b){function c(j){j[0]||(j=[]);return new fa(j)}if(typeof a==="string"){if(b)b=Z(b);var d=a.length;if(a.charAt(0)==="@")a=a.substr(1);if(a.length!==d||/<.+>/.test(a)){d=(b?b.ownerDocument||b:document).createElement("div");var e=[];if(d.nodeType==1)d.innerHTML=""+a;for(var f=0,h=d.childNodes.length;f<h;f++)e.push(d.childNodes[f]);return c(e)}return c(la(a,b))}if(a&&a.get)return a;if(x(a))return c(a);
return c(aa(arguments))};k(Na,function(a,b){i[a]=b});if(n.K===g)n.K=i;n.KindEditor=i;var Ba=0,va=1,wa=2,xa=3;oa.prototype={commonAncestor:function(){function a(m){for(var t=[];m;){t.push(m);m=m.parentNode}return t}for(var b=a(this.startContainer),c=a(this.endContainer),d=0,e=b.length,f=c.length,h,j;++d;){h=b[e-d];j=c[f-d];if(!h||!j||h!==j)break}return b[e-d+1]},setStart:function(a,b){var c=this.doc;this.startContainer=a;this.startOffset=b;if(this.endContainer===c){this.endContainer=a;this.endOffset=
b}Ra.call(this);return this},setEnd:function(a,b){var c=this.doc;this.endContainer=a;this.endOffset=b;if(this.startContainer===c){this.startContainer=a;this.startOffset=b}Ra.call(this);return this},setStartBefore:function(a){return this.setStart(a.parentNode||this.doc,i(a).index())},setStartAfter:function(a){return this.setStart(a.parentNode||this.doc,i(a).index()+1)},setEndBefore:function(a){return this.setEnd(a.parentNode||this.doc,i(a).index())},setEndAfter:function(a){return this.setEnd(a.parentNode||
this.doc,i(a).index()+1)},selectNode:function(a){return this.setStartBefore(a).setEndAfter(a)},selectNodeContents:function(a){var b=i(a);if(b.type==3||b.isSingle())return this.selectNode(a);b=b.children();if(b.length>0)return this.setStartBefore(b[0].get()).setEndAfter(b[b.length-1].get());return this.setStart(a,0).setEnd(a,0)},collapse:function(a){if(a)return this.setEnd(this.startContainer,this.startOffset);return this.setStart(this.endContainer,this.endOffset)},compareBoundaryPoints:function(a,
b){var c=this.get(),d=b.get();if(this.doc.createRange)return c.compareBoundaryPoints(a,d);else{var e={};e[Ba]="StartToStart";e[va]="EndToStart";e[wa]="EndToEnd";e[xa]="StartToEnd";c=c.compareEndPoints(e[a],d);if(c!==0)return c;var f,h,j,m;if(a===Ba||a===xa){f=this.startContainer;j=this.startOffset}if(a===va||a===wa){f=this.endContainer;j=this.endOffset}if(a===Ba||a===va){h=b.startContainer;m=b.startOffset}if(a===wa||a===xa){h=b.endContainer;m=b.endOffset}if(f===h){f=j-m;return f>0?1:f<0?-1:0}for(c=
h;c&&c.parentNode!==f;)c=c.parentNode;if(c)return i(c).index()>=j?-1:1;for(c=f;c&&c.parentNode!==h;)c=c.parentNode;if(c)return i(c).index()>=m?1:-1}},cloneRange:function(){return(new oa(this.doc)).setStart(this.startContainer,this.startOffset).setEnd(this.endContainer,this.endOffset)},toString:function(){var a=this.get();return(this.doc.createRange?a.toString():a.text).replace(/\r\n|\n|\r/g,"")},cloneContents:function(){return Ja.call(this,true,false)},deleteContents:function(){return Ja.call(this,
false,true)},extractContents:function(){return Ja.call(this,true,true)},insertNode:function(a){var b=this.startContainer,c=this.startOffset,d=this.endContainer,e=this.endOffset,f,h,j,m=1;if(a.nodeName.toLowerCase()==="#document-fragment"){f=a.firstChild;h=a.lastChild;m=a.childNodes.length}if(b.nodeType==1)if(j=b.childNodes[c]){b.insertBefore(a,j);if(b===d)e+=m}else b.appendChild(a);else if(b.nodeType==3)if(c===0){b.parentNode.insertBefore(a,b);if(b.parentNode===d)e+=m}else if(c>=b.nodeValue.length)b.nextSibling?
b.parentNode.insertBefore(a,b.nextSibling):b.parentNode.appendChild(a);else{j=b.splitText(c);b.parentNode.insertBefore(a,j);if(b===d){d=j;e-=c}}f?this.setStartBefore(f).setEndAfter(h):this.selectNode(a);if(this.compareBoundaryPoints(wa,this.cloneRange().setEnd(d,e))>=1)return this;return this.setEnd(d,e)},surroundContents:function(a){a.appendChild(this.extractContents());return this.insertNode(a).selectNode(a)},isControl:function(){var a=this.startContainer,b=this.startOffset,c=this.endContainer,
d=this.endOffset;return a.nodeType==1&&a===c&&b+1===d&&i(a.childNodes[b]).name==="img"},get:function(a){var b=this.doc,c=this.startContainer,d=this.startOffset,e=this.endContainer,f=this.endOffset;if(b.createRange){a=b.createRange();try{a.setStart(c,d);a.setEnd(e,f)}catch(h){}return a}if(a&&this.isControl()){a=b.body.createControlRange();a.addElement(c.childNodes[d]);return a}a=b.body.createTextRange();a.setEndPoint("StartToStart",Ua(c,d));a.setEndPoint("EndToStart",Ua(e,f));return a},html:function(){return i(this.cloneContents()).outer()}};
i.range=Ca;i.START_TO_START=Ba;i.START_TO_END=va;i.END_TO_END=wa;i.END_TO_START=xa;var qb=O("9,32,48..57,59,61,65..90,106,109..111,188,190..192,219..222"),rb=O("8,13,33..40,46"),Oa={};k(qb,function(a,b){Oa[a]=b});k(rb,function(a,b){Oa[a]=b});Da.prototype={select:function(){var a=this.sel,b=this.range.cloneRange(),c=b.startContainer,d=c.ownerDocument||c,e=Aa(d);if(Y&&c.nodeType==1&&b.collapsed){a=i("<span>&nbsp;</span>",d);b.insertNode(a.get());b=d.body.createTextRange();b.moveToElementText(a.get());
b.collapse(false);b.select();a.remove();e.focus();return this}b=b.get(true);if(Y)b.select();else{a.removeAllRanges();a.addRange(b)}e.focus();return this},wrap:function(a){function b(q,p,r){var v=q.nodeValue.length,A=q;if(!(r<=p)){if(p>0)A=q.splitText(p);r<v&&A.splitText(r-p);var y;r=i(A);p=h==q;for(q=m==q;(y=r.parent())&&y.isInline()&&y.children().length==1;){p||(p=h==y.get());q||(q=m==y.get());r=y}y=r;r=f;r=r.clone(true);if(y.type==3){qa(r).append(y.clone(false));y.before(r);y.remove()}else{v=y;
for(var u;(u=y.first())&&u.children().length==1;)y=u;for(A=y.doc.createDocumentFragment();u=y.first();){u.next();A.appendChild(u.get())}r=bb(v,r);A.firstChild&&qa(r).append(A);v.before(r);v.remove()}u=r.get();p&&e.setStartBefore(u);q&&e.setEndAfter(u)}}function c(q){var p=q.firstChild;if(q.nodeType==3){b(q,j,t);return false}for(var r;p;){q=Ca(d);q.selectNode(p);if(q.compareBoundaryPoints(xa,e)>=0)return false;r=p.nextSibling;if(q.compareBoundaryPoints(va,e)>0)if(p.nodeType==1){if(c(p)===false)return false}else if(p.nodeType==
3)if(p==h&&p==m)b(p,j,t);else if(p==h)b(p,j,p.nodeValue.length);else p==m?b(p,0,t):b(p,0,p.nodeValue.length);p=r}}var d=this.doc,e=this.range,f,h=e.startContainer,j=e.startOffset,m=e.endContainer,t=e.endOffset;f=typeof a=="string"?i(a,d):a;if(e.collapsed){if(this._preformat)f=bb(this._preformat.wrapper,f);a=0;if(h.nodeType==3)a=h.nodeValue.length;else if(j>0)a=h.childNodes[j-1].nodeValue.length;this._preformat={wrapper:f,textLength:a,range:e.cloneRange()};return this}if(!f.isInline()){for(var s=a=
f.clone(true);s.first();)s=s.first();s.append(e.extractContents());e.insertNode(a.get()).selectNode(a.get());return this}c(e.commonAncestor());return this},split:function(a,b){for(var c=this.range,d=c.doc,e=c.cloneRange().collapse(a),f=e.startContainer,h=e.startOffset,j=f.nodeType==3?f.parentNode:f,m=false,t;j&&j.parentNode;){t=i(j);if(!t.isInline())break;if(!Ka(t,b))break;m=true;j=j.parentNode}if(m){d=d.createElement("span");c.cloneRange().collapse(!a).insertNode(d);a?e.setStartBefore(j.firstChild).setEnd(f,
h):e.setStart(f,h).setEndAfter(j.lastChild);f=e.extractContents();h=f.firstChild;m=f.lastChild;if(a){e.insertNode(f);c.setStartAfter(m).setEndBefore(d)}else{j.appendChild(f);c.setStartBefore(d).setEndBefore(h)}e=d.parentNode;e.removeChild(d);!a&&e===c.endContainer&&c.setEnd(c.endContainer,c.endOffset-1)}return this},remove:function(a){var b=this.range;if(b.collapsed){this._preremove={map:a,range:b.cloneRange()};return this}this.split(true,a);this.split(false,a);var c=[];i(b.commonAncestor()).scan(function(m){c.push(i(m))});
var d=b.startContainer,e=b.startOffset,f=b.endContainer,h=b.endOffset;if(e>0){var j=i(d.childNodes[e-1]);if(j&&qa(j).isInline()){j.remove();b.setStart(d,e-1);d==f&&b.setEnd(f,h-1)}if((j=i(d.childNodes[e]))&&qa(j).isInline()){j.remove();d==f&&b.setEnd(f,h-1)}}(b=i(f.childNodes[b.endOffset]))&&qa(b).isInline()&&b.remove();k(c,function(){ab(this,a,"*");ab(this,a)});return this},_applyPreformat:function(){var a=this.range,b=a.startContainer,c=a.startOffset,d=this._preformat,e=this._preremove;if(d||e){d?
a.setStart(d.range.startContainer,d.range.startOffset):a.setStart(e.range.startContainer,e.range.startOffset);if(d){a.collapsed&&c>0&&a.setStart(b.childNodes[c-1],d.textLength);this.wrap(d.wrapper)}if(e){if(a.collapsed){this._preremove=this._preformat=null;return}this.remove(e.map)}b=a.startContainer;c=a.startOffset;b=qa(i(b.nodeType==3?b:b.childNodes[c])).get();a.setEnd(b,b.nodeValue.length);a.collapse(false);this.select();this._preremove=this._preformat=null}},commonNode:function(a){var b=this.range,
c=b.endContainer;b=b.endOffset;for(b=c=c.nodeType==3||b===0?c:c.childNodes[b-1];b&&(b=b.firstChild)&&b.childNodes.length==1;)if(Ka(i(b),a))return i(b);for(;c;){if(Ka(i(c),a))return i(c);c=c.parentNode}return null},state:function(a){var b=this.doc,c=false;try{c=b.queryCommandState(a)}catch(d){}return c},val:function(a){var b=this.doc;a=a.toLowerCase();var c="";if(a==="fontfamily"||a==="fontname"){c=Va(b,"fontname");c=c.replace(/['"]/g,"");return c.toLowerCase()}if(a==="formatblock"){c=Va(b,a);if(c===
"")if(a=this.commonNode({"h1,h2,h3,h4,h5,h6,p,div,pre,address":"*"}))c=a.name;if(c==="Normal")c="p";return c.toLowerCase()}if(a==="fontsize"){if(a=this.commonNode({"*":".font-size"}))c=a.css("font-size");return c.toLowerCase()}if(a==="forecolor"){if(a=this.commonNode({"*":".color"}))c=a.css("color");c=T(c);if(c==="")c="default";return c.toLowerCase()}if(a==="hilitecolor"){if(a=this.commonNode({"*":".background-color"}))c=a.css("background-color");c=T(c);if(c==="")c="default";return c.toLowerCase()}if(a===
"createlink"){if(a=this.commonNode({a:"*"}))c=a.attr("href");return c}return c},toggle:function(a,b){this.commonNode(b)?this.remove(b):this.wrap(a);return this.select()},bold:function(){return this.toggle("<strong></strong>",{span:".font-weight=bold",strong:"*",b:"*"})},italic:function(){return this.toggle("<em></em>",{span:".font-style=italic",em:"*",i:"*"})},underline:function(){return this.toggle("<u></u>",{span:".text-decoration=underline",u:"*"})},strikethrough:function(){return this.toggle("<s></s>",
{span:".text-decoration=line-through",s:"*"})},forecolor:function(a){return this.toggle('<span style="color:'+a+';"></span>',{span:".color="+a,font:"color"})},hilitecolor:function(a){return this.toggle('<span style="background-color:'+a+';"></span>',{span:".background-color="+a})},fontsize:function(a){return this.toggle('<span style="font-size:'+a+';"></span>',{span:".font-size="+a,font:"size"})},fontname:function(a){return this.fontfamily(a)},fontfamily:function(a){return this.toggle('<span style="font-family:'+
a+';"></span>',{span:".font-family="+a,font:"face"})},removeformat:function(){var a={"*":"class,style"};k(ob,function(b){a[b]="*"});this.remove(a);return this.select()},inserthtml:function(a){var b=this.doc,c=this.range,d=b.createDocumentFragment();i("@"+a,b).each(function(){d.appendChild(this)});c.deleteContents();c.insertNode(d);c.collapse(false);return this.select()},hr:function(){return this.inserthtml("<hr />")},print:function(){this.win.print();return this},insertimage:function(a,b,c,d,e,f){b=
ca(b,"");e=ca(e,0);a='<img src="'+a+'" ';if(c)a+='width="'+c+'" ';if(d)a+='height="'+d+'" ';if(b)a+='title="'+b+'" ';if(f)a+='align="'+f+'" ';a+='alt="'+b+'" ';a+='border="'+e+'" />';return this.inserthtml(a)},createlink:function(a,b){var c=this.doc,d=this.range;this.select();var e=this.commonNode({a:"*"});if(e&&!d.isControl()){d.selectNode(e.get());this.select()}if(d.collapsed){c='<a href="'+a+'"';if(b)c+=' target="'+b+'"';c+=">"+a+"</a>";this.inserthtml(c);return this}ya(c,"createlink","__ke_temp_url__");
e=this.commonNode({a:"*"});i('a[href="__ke_temp_url__"]',e?e.parent():c).each(function(){i(this).attr("href",a);b?i(this).attr("target",b):i(this).removeAttr("target")});return this},unlink:function(){var a=this.doc,b=this.range;this.select();if(b.collapsed){var c=this.commonNode({a:"*"});if(c){b.selectNode(c.get());this.select()}ya(a,"unlink",null);if(La&&i(b.startContainer).name==="img"){a=i(b.startContainer).parent();a.name==="a"&&$a(a)}return this}ya(a,"unlink",null);return this},oninput:function(a){i(this.doc).keyup(function(b){if(!b.ctrlKey&&
!b.altKey&&qb[b.which]){a(b);b.stop()}});return this},oncursormove:function(a){var b=this.doc;i(b).keyup(function(c){if(!c.ctrlKey&&!c.altKey&&rb[c.which]){a(c);c.stop()}});i(b).mouseup(a);return this},onchange:function(a){function b(e){setTimeout(function(){a(e)},1)}var c=this.doc,d=c.body;i(c).keyup(function(e){if(!e.ctrlKey&&!e.altKey&&Oa[e.which]){a(e);e.stop()}});i(c).mouseup(a);c!==document&&i(document).mousedown(a);i(d).bind("paste",b);i(d).bind("cut",b);return this}};k("formatblock,selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript".split(","),
function(a,b){Da.prototype[b]=function(c){ya(this.doc,b,c);return this}});k("cut,copy,paste".split(","),function(a,b){Da.prototype[b]=function(){if(!this.doc.queryCommandSupported(b))throw"not supported";ya(this.doc,b,null);return this}});i.cmd=cb;i.widget=ra;i.edit=eb;i.iframeDoc=Ma;i.toolbar=gb;i.menu=hb;i.colorpicker=ib;i.dialog=jb;var nb=[],na={};mb.prototype={lang:function(a){return lb(a,this.langType)},handler:function(a,b){var c=this;c._handlers[a]||(c._handlers[a]=[]);if(b===g){k(c._handlers[a],
function(){this.call(c)});return c}c._handlers[a].push(b);return c},clickToolbar:function(a,b){return this.handler("clickToolbar"+a,b)},afterCreate:function(a){return this.handler("afterCreate",a)},beforeHideMenu:function(a){return this.handler("beforeHideMenu",a)},create:function(){function a(){b.container&&b.resize(ea().clientWidth,ea().clientHeight)}var b=this,c=b.fullscreenMode;if(c)ea().style.overflow="hidden";else ea().style.overflow="auto";var d=c?vb()+"px":b.width,e=c?ub()+"px":b.height,f=
i('<div class="ke-container"></div>').css("width",d);if(c){var h=Ia();f.css({position:"absolute",left:z(h.x),top:z(h.y),"z-index":811211});i(document.body).append(f)}else b.srcElement.before(f);var j=gb({parent:f,noDisableItems:"source,fullscreen".split(",")});k(b.items,function(s,q){j.addItem({name:q,title:b.lang(q),click:function(){if(b.menu){var p=b.menu.name;b.hideMenu();if(p===q)return}b.clickToolbar(q)}})});b.designMode||j.disable(true);h=eb({parent:f,srcElement:b.srcElement,designMode:b.designMode,
themesPath:b.themesPath,bodyClass:b.bodyClass,cssPath:b.cssPath,cssData:b.cssData});i(h.doc,document).click(function(){b.menu&&b.hideMenu()});var m=i('<div class="ke-statusbar"></div>'),t;f.append(m);if(!c){t=i('<span class="ke-inline-block ke-statusbar-right-icon"></span>');m.append(t);db({moveEl:f,clickEl:t,moveFn:function(s,q,p,r,v,A){p+=v;r+=A;p>=b.minWidth&&b.resize(p,null);r>=b.minHeight&&b.resize(null,r)}})}if(b._resizeListener){i(n).unbind("resize",b._resizeListener);b._resizeListener=null}if(b.fullscreenMode){i(n).bind("resize",
a);b._resizeListener=a}b.container=f;b.toolbar=j;b.edit=h;b.statusbar=m;b.menu=b.dialog=null;b._rightIcon=t;b.resize(d,e);b.afterCreate();return b},remove:function(){this.menu&&this.hideMenu();this.dialog&&this.hideDialog();this.toolbar.remove();this.edit.remove();this._rightIcon&&this._rightIcon.remove();this.statusbar.remove();this.container.remove();this.container=this.toolbar=this.edit=this.menu=this.dialog=null;return this},resize:function(a,b){a!==null&&this.container.css("width",z(a));if(b!==
null){b=L(b)-this.toolbar.div().height()-this.statusbar.height()-11;b>0&&this.edit.height(b)}return this},select:function(){this.edit.cmd.select();return this},html:function(a){if(a===g)return this.edit.html();this.edit.html(a);return this},insertHtml:function(a){this.edit.cmd.inserthtml(a);return this},val:function(a){return this.edit.cmd.val(a)},state:function(a){return this.edit.cmd.state(a)},exec:function(a){var b=this.edit.cmd;b[a].apply(b,aa(arguments,1));return this},focus:function(){this.edit.focus();
return this},fullscreen:function(a){this.fullscreenMode=a===g?!this.fullscreenMode:a;this.remove();return this.create()},createMenu:function(a){var b=this.toolbar.get(a.name),c=b.pos();a.x=c.x;a.y=c.y+b.height();if(a.selectedColor!==g){a.noColor=this.lang("noColor");this.menu=ib(a)}else{a.centerLineMode=false;this.menu=hb(a)}return this.menu},hideMenu:function(){this.beforeHideMenu();this.menu.remove();this.menu=null;return this},createDialog:function(a){var b=this;a.shadowMode=b.shadowMode;a.closeBtn=
{name:b.lang("close"),click:function(){b.hideDialog();b.focus()}};a.noBtn={name:b.lang("no"),click:function(){b.hideDialog();b.focus()}};return b.dialog=jb(a)},hideDialog:function(){this.dialog.remove();this.dialog=null;return this}};Y&&ua<7&&ya(document,"BackgroundImageCache",true);i.create=function(a,b){b||(b={});var c=i(a);if(c){b.srcElement=c[0];if(!b.width)b.width=c.width();if(!b.height)b.height=c.height();return(new mb(b)).create()}};i.plugin=function(a){nb.push(a)};i.lang=lb})(window);
KindEditor.plugin(function(n){var g=this;g.clickToolbar("source",function(){g.toolbar.disable();g.edit.design()});g.clickToolbar("fullscreen",function(){g.fullscreen()});g.clickToolbar("formatblock",function(){var x=g.lang("formatblock.formatBlock"),o={h1:28,h2:24,h3:18,H4:14,p:12},k=g.val("formatblock"),H=g.createMenu({name:"formatblock",width:g.langType=="en"?200:150});n.each(x,function(K,z){var L="font-size:"+o[K]+"px;";if(K.charAt(0)==="h")L+="font-weight:bold;";H.addItem({title:'<span style="'+
L+'">'+z+"</span>",height:o[K]+12,checked:k===K||k===z,click:function(){g.select().exec("formatblock","<"+K.toUpperCase()+">").hideMenu()}})})});g.clickToolbar("fontname",function(){var x=g.val("fontname"),o=g.createMenu({name:"fontname",width:150});n.each(g.lang("fontname.fontName"),function(k,H){o.addItem({title:'<span style="font-family: '+k+';">'+H+"</span>",checked:x===k.toLowerCase()||x===H.toLowerCase(),click:function(){g.exec("fontname",k).hideMenu()}})})});g.clickToolbar("fontsize",function(){var x=
g.val("fontsize");menu=g.createMenu({name:"fontsize",width:150});n.each(["9px","10px","12px","14px","16px","18px","24px","32px"],function(o,k){menu.addItem({title:'<span style="font-size:'+k+';">'+k+"</span>",height:n.removeUnit(k)+12,checked:x===k,click:function(){g.exec("fontsize",k).hideMenu()}})})});n.each("forecolor,hilitecolor".split(","),function(x,o){g.clickToolbar(o,function(){g.createMenu({name:o,selectedColor:g.val(o)||"default",click:function(k){g.exec(o,k).hideMenu()}})})});n.each("cut,copy,paste".split(","),
function(x,o){g.clickToolbar(o,function(){g.focus();try{g.exec(o,null)}catch(k){alert(g.lang(o+"Error"))}})});g.clickToolbar("about",function(){var x='<div style="margin:20px;"><div>KindEditor '+n.kindeditor+'</div><div>Copyright &copy; <a href="http://www.kindsoft.net/" target="_blank">kindsoft.net</a> All rights reserved.</div></div>';g.createDialog({name:"about",width:300,title:g.lang("about"),body:x})});n.each("selectall,justifyleft,justifycenter,justifyright,justifyfull,insertorderedlist,insertunorderedlist,indent,outdent,subscript,superscript,hr,print,bold,italic,underline,strikethrough,removeformat,unlink".split(","),
function(x,o){g.shortcutKeys[o]&&g.afterCreate(function(){n.ctrl(this.edit.doc,g.shortcutKeys[o],function(){g.clickToolbar(o)})});g.clickToolbar(o,function(){g.focus().exec(o,null)})})});
KindEditor.plugin(function(n){var g=this;g.clickToolbar("plainpaste",function(){var x='<div style="margin:10px;"><div style="margin-bottom:10px;">'+g.lang("plainpaste.").comment+'</div><textarea style="width:415px;height:260px;border:1px solid #A0A0A0;"></textarea></div>';x=g.createDialog({name:"plainpaste",width:450,title:g.lang("plainpaste"),body:x,yesBtn:{name:g.lang("yes"),click:function(){var k=o.val();k=n.escape(k);k=k.replace(/ /g,"&nbsp;");k=k.replace(/\r\n|\n|\r/g,"<br />$&");g.insertHtml(k).hideDialog().focus()}}});
var o=n("textarea",x.div());o.get().focus()})});
KindEditor.plugin(function(n){var g=this;g.clickToolbar("wordpaste",function(){var x='<div style="margin:10px;"><div style="margin-bottom:10px;">'+g.lang("wordpaste.").comment+'</div><iframe style="width:415px;height:260px;border:1px solid #A0A0A0;" frameborder="0"></iframe></div>';x=g.createDialog({name:"wordpaste",width:450,title:g.lang("wordpaste"),body:x,yesBtn:{name:g.lang("yes"),click:function(){var k=o.body.innerHTML;k=k.replace(/<meta(\n|.)*?>/ig,"");k=k.replace(/<!(\n|.)*?>/ig,"");k=k.replace(/<style[^>]*>(\n|.)*?<\/style>/ig,
"");k=k.replace(/<script[^>]*>(\n|.)*?<\/script>/ig,"");k=k.replace(/<w:[^>]+>(\n|.)*?<\/w:[^>]+>/ig,"");k=k.replace(/<xml>(\n|.)*?<\/xml>/ig,"");k=k.replace(/\r\n|\n|\r/ig,"");g.insertHtml(k).hideDialog().focus()}}}).div();x=n("iframe",x.get());var o=n.iframeDoc(x);if(!n.IE)o.designMode="on";o.open();o.write("<html><head><title>WordPaste</title></head>");o.write('<body style="background-color:#FFFFFF;font-size:12px;margin:2px;" />');n.IE||o.write("<br />");o.write("</body></html>");o.close();if(n.IE)o.body.contentEditable=
"true";x.get().contentWindow.focus()})});
KindEditor.plugin(function(n){var g=this;g.clickToolbar("link",function(){var x=g.lang("link."),o='<div style="margin:10px;"><div class="ke-dialog-row"><label for="keUrl">'+x.url+'</label><input type="text" id="keUrl" name="url" value="" style="width:90%;" /></div><div class="ke-dialog-row""><label for="keType">'+x.linkType+'</label><select id="keType" name="type"></select></div></div>';o=g.createDialog({name:"link",width:400,title:g.lang("link"),body:o,yesBtn:{name:g.lang("yes"),click:function(){g.exec("createlink",
k.val(),H.val()).hideDialog().focus()}}}).div();var k=n('input[name="url"]',o),H=n('select[name="type"]',o);H.get().options[0]=new Option(x.newWindow,"_blank");H.get().options[1]=new Option(x.selfWindow,"");k.val(g.val("createlink"));k.get().focus()})});
KindEditor.plugin(function(n){var g=this,x=g.emoticonsPath||g.scriptPath+"plugins/emoticons/images/",o=g.allowPreviewEmoticons===undefined?true:g.allowPreviewEmoticons,k=1;g.clickToolbar("emoticons",function(){function H(R,P,N){M?R.mouseover(function(){if(P>$){M.css("left",0);M.css("right","")}else{M.css("left","");M.css("right",0)}da.attr("src",x+N+".gif");n(this).addClass("ke-plugin-emoticons-cell-on")}):R.mouseover(function(){n(this).addClass("ke-plugin-emoticons-cell-on")});R.mouseout(function(){n(this).removeClass("ke-plugin-emoticons-cell-on")});
R.click(function(ja){g.insertHtml('<img src="'+x+N+'.gif" border="0" alt="" />').hideMenu().focus();ja.stop()})}function K(R,P){var N=document.createElement("table");P.append(N);if(M){n(N).mouseover(function(){M.show()});n(N).mouseout(function(){M.hide()});W.push(n(N))}N.className="ke-plugin-emoticons-table";N.cellPadding=0;N.cellSpacing=0;N.border=0;for(var ja=(R-1)*sa+ca,ka=0;ka<O;ka++)for(var ta=N.insertRow(ka),la=0;la<aa;la++){var Z=n(ta.insertCell(la));Z.addClass("ke-plugin-emoticons-cell");
H(Z,la,ja);var Ea=n('<span class="ke-plugin-emoticons-img"></span>').css("background-position","-"+24*ja+"px 0px").css("background-image","url("+x+"static.gif)");Z.append(Ea);W.push(Z);ja++}return N}function z(){n.each(W,function(){this.unbind()})}function L(R,P){R.click(function(N){z();ba.parentNode.removeChild(ba);X.remove();ba=K(P,V);T(P);k=P;N.stop()})}function T(R){X=n('<div class="ke-plugin-emoticons-page"></div>');V.append(X);for(var P=1;P<=ha;P++){if(R!==P){var N=n('<a href="javascript:;">['+
P+"]</a>");L(N,P);X.append(N);W.push(N)}else X.append(n("@["+P+"]"));X.append(n("@&nbsp;"))}}var O=5,aa=9,ca=0,sa=O*aa,ha=Math.ceil(135/sa),$=Math.floor(aa/2),V=n('<div class="ke-plugin-emoticons-wrapper"></div>'),W=[];g.createMenu({name:"emoticons"}).div().append(V);var M,da;if(o){M=n('<div class="ke-plugin-emoticons-preview"></div>').css("right",0);da=n('<img class="ke-plugin-emoticons-preview-img" src="'+x+ca+'.gif" />');V.append(M);M.append(da)}var ba=K(k,V),X;T(k);g.beforeHideMenu(function(){z()})})});
KindEditor.plugin(function(n){var g=this;_undef(g.allowUpload,true);_undef(g.allowFileManager,false);var x=_undef(g.imageUploadJson,g.scriptPath+"php/upload_json.php"),o=this.scriptPath+"plugins/image/images/",k=g.lang("image.");g.clickToolbar("image",function(){var H=['<div style="margin:10px;"><div class="tabs"></div><iframe name="uploadIframe" style="display:none;"></iframe><form name="uploadForm" method="post" enctype="multipart/form-data" target="uploadIframe"><input type="hidden" name="referMethod" value="" /><div class="ke-dialog-row"><div class="tab1" style="display:none;">',
'<label for="keUrl">'+k.remoteUrl+"</label>",'<input type="text" id="keUrl" name="url" value="" style="width:230px;" />',' <input type="button" name="viewServer" value="'+k.viewServer+'" />','</div><div class="tab2" style="display:none;">','<label for="keFile">'+k.localUrl+"</label>",'<input type="file" id="keFile" name="imgFile" style="width:300px;" /></div></div><div class="ke-dialog-row">','<label for="keWidth">'+k.size+"</label>",k.width+' <input type="text" id="keWidth" name="width" value="" maxlength="4" style="width:50px;text-align:right;" /> ',
k.height+' <input type="text" name="height" value="" maxlength="4" style="width:50px;text-align:right;" /> ','<img src="'+o+'refresh.gif" width="16" height="16" alt="" />','</div><div class="ke-dialog-row">',"<label>"+k.align+"</label>",'<input type="radio" name="align" value="" checked="checked" /> <img name="defaultImg" src="'+o+'align_top.gif" width="23" height="25" alt="" />',' <input type="radio" name="align" value="left" /> <img name="leftImg" src="'+o+'align_left.gif" width="23" height="25" alt="" />',
' <input type="radio" name="align" value="right" /> <img name="rightImg" src="'+o+'align_right.gif" width="23" height="25" alt="" />','</div><div class="ke-dialog-row">','<label for="keTitle">'+k.imgTitle+"</label>",'<input type="text" id="keTitle" name="title" value="" style="width:95%;" /></div></div></form></div>'].join(""),K=g.createDialog({name:"image",width:450,height:300,title:g.lang("image"),body:H,yesBtn:{name:g.lang("yes"),click:function(){var V=L.val(),W=T.val(),M=O.val(),da=aa.val(),ba=
"";ca.each(function(){if(this.checked){ba=this.value;return false}});if(z.selectedIndex===1){V=n('[name="uploadForm"]',K);var X=n('[name="uploadIframe"]',K);V.attr("action",x);X.bind("load",function(){X.unbind();var R={};try{R=n.json(_iframeDoc(X).body.innerHTML)}catch(P){alert(g.lang("invalidJson"))}if("error"in R)if(R.error===0)g.exec("insertimage",R.url,da,W,M,0,ba).hideDialog().focus();else{alert(R.message);return false}});V[0].submit()}else g.exec("insertimage",V,da,W,M,0,ba).hideDialog().focus()}}}).div(),
z=n.tabs({parent:n(".tabs",K),afterSelect:function(){}});z.add({title:k.remoteImage,panel:n(".tab1",K)});z.add({title:k.localImage,panel:n(".tab2",K)});z.select(0);var L=n('[name="url"]',K),T=n('[name="width"]',K),O=n('[name="height"]',K),aa=n('[name="title"]',K),ca=n('[name="align"]');H=g.edit.cmd.range;var sa=H.startContainer,ha=H.startOffset;if(n.WEBKIT||H.isControl()){var $=n(sa.childNodes[ha]);if(!($.name!=="img"||/^ke-\w+$/i.test($[0].className))){L.val($.attr("src"));T.val($.width());O.val($.height());
aa.val($.attr("title"));ca.each(function(){if(this.value===$.attr("align")){this.checked=true;return false}});L[0].focus()}}})});
KindEditor.plugin(function(n){var g=this,x=g.lang("flash.");g.clickToolbar("flash",function(){var o=['<div style="margin:10px;"><div class="ke-dialog-row">','<label for="keUrl">'+x.url+"</label>",'<input type="text" id="keUrl" name="url" value="" style="width:90%;" /></div><div class="ke-dialog-row">','<label for="keWidth">'+x.width+"</label>",'<input type="text" id="keWidth" name="width" value="550" maxlength="4" style="width:50px;text-align:right;" /> </div><div class="ke-dialog-row">','<label for="keHeight">'+
x.height+"</label>",'<input type="text" id="keHeight" name="height" value="400" maxlength="4" style="width:50px;text-align:right;" /> </div></div>'].join("");o=g.createDialog({name:"flash",width:400,height:200,title:g.lang("flash"),body:o,yesBtn:{name:g.lang("yes"),click:function(){var T=k.val();T=n.mediaImg(g.themesPath+"common/blank.gif",{src:T,type:n.mediaType(".swf"),width:H.val(),height:K.val(),quality:"high"});g.insertHtml(T).hideDialog().focus()}}}).div();var k=n('[name="url"]',o),H=n('[name="width"]',
o),K=n('[name="height"]',o);o=g.edit.cmd.range;var z=o.startContainer,L=o.startOffset;if(n.WEBKIT||o.isControl()){o=n(z.childNodes[L]);if(!(o.name!=="img"||o[0].className!=="ke-flash")){z=n.mediaAttrs(o.attr("kesrctag"));k.val(z.src);H.val(n.removeUnit(o.css("width"))||z.width||0);K.val(n.removeUnit(o.css("height"))||z.height||0);k[0].focus()}}})});
KindEditor.plugin(function(n){var g=this,x=g.lang("media.");g.clickToolbar("media",function(){var o=['<div style="margin:10px;"><div class="ke-dialog-row">','<label for="keUrl">'+x.url+"</label>",'<input type="text" id="keUrl" name="url" value="" style="width:90%;" /></div><div class="ke-dialog-row">','<label for="keWidth">'+x.width+"</label>",'<input type="text" id="keWidth" name="width" value="550" maxlength="4" style="width:50px;text-align:right;" /></div><div class="ke-dialog-row">','<label for="keHeight">'+
x.height+"</label>",'<input type="text" id="keHeight" name="height" value="400" maxlength="4" style="width:50px;text-align:right;" /></div><div class="ke-dialog-row">','<label for="keAutostart">'+x.autostart+"</label>",'<input type="checkbox" id="keAutostart" name="autostart" value="" /> </div></div>'].join("");o=g.createDialog({name:"media",width:400,height:230,title:g.lang("media"),body:o,yesBtn:{name:g.lang("yes"),click:function(){var O=k.val();O=n.mediaImg(g.themesPath+"common/blank.gif",{src:O,
type:n.mediaType(O),width:H.val(),height:K.val(),autostart:z[0].checked?"true":"false",loop:"true"});g.insertHtml(O).hideDialog().focus()}}}).div();var k=n('[name="url"]',o),H=n('[name="width"]',o),K=n('[name="height"]',o),z=n('[name="autostart"]',o);o=g.edit.cmd.range;var L=o.startContainer,T=o.startOffset;if(n.WEBKIT||o.isControl()){o=n(L.childNodes[T]);console.log(o[0].className);if(!(o.name!=="img"||!/^ke-\w+$/.test(o[0].className))){console.log(o[0].className);L=n.mediaAttrs(o.attr("kesrctag"));
k.val(L.src);H.val(n.removeUnit(o.css("width"))||L.width||0);K.val(n.removeUnit(o.css("height"))||L.height||0);z[0].checked=L.autostart==="true";k[0].focus()}}})});
